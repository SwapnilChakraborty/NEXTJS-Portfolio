{"version":3,"file":"sdk.js","sources":["../../src/sdk.ts"],"sourcesContent":["import {\n  functionToStringIntegration,\n  getIntegrationsToSetup,\n  inboundFiltersIntegration,\n  initAndBind,\n  linkedErrorsIntegration,\n  requestDataIntegration,\n} from '@sentry/core';\nimport type { Integration, Options } from '@sentry/types';\nimport { GLOBAL_OBJ, createStackParser, nodeStackLineParser, stackParserFromStackParserOptions } from '@sentry/utils';\n\nimport { setAsyncLocalStorageAsyncContextStrategy } from './async';\nimport { VercelEdgeClient } from './client';\nimport { winterCGFetchIntegration } from './integrations/wintercg-fetch';\nimport { makeEdgeTransport } from './transports';\nimport type { VercelEdgeClientOptions, VercelEdgeOptions } from './types';\nimport { getVercelEnv } from './utils/vercel';\n\ndeclare const process: {\n  env: Record<string, string>;\n};\n\nconst nodeStackParser = createStackParser(nodeStackLineParser());\n\n/** @deprecated Use `getDefaultIntegrations(options)` instead. */\nexport const defaultIntegrations = [\n  inboundFiltersIntegration(),\n  functionToStringIntegration(),\n  linkedErrorsIntegration(),\n  winterCGFetchIntegration(),\n];\n\n/** Get the default integrations for the browser SDK. */\nexport function getDefaultIntegrations(options: Options): Integration[] {\n  return [\n    // eslint-disable-next-line deprecation/deprecation\n    ...defaultIntegrations,\n    ...(options.sendDefaultPii ? [requestDataIntegration()] : []),\n  ];\n}\n\n/** Inits the Sentry NextJS SDK on the Edge Runtime. */\nexport function init(options: VercelEdgeOptions = {}): void {\n  setAsyncLocalStorageAsyncContextStrategy();\n\n  if (options.defaultIntegrations === undefined) {\n    options.defaultIntegrations = getDefaultIntegrations(options);\n  }\n\n  if (options.dsn === undefined && process.env.SENTRY_DSN) {\n    options.dsn = process.env.SENTRY_DSN;\n  }\n\n  if (options.tracesSampleRate === undefined && process.env.SENTRY_TRACES_SAMPLE_RATE) {\n    const tracesSampleRate = parseFloat(process.env.SENTRY_TRACES_SAMPLE_RATE);\n    if (isFinite(tracesSampleRate)) {\n      options.tracesSampleRate = tracesSampleRate;\n    }\n  }\n\n  if (options.release === undefined) {\n    const detectedRelease = getSentryRelease();\n    if (detectedRelease !== undefined) {\n      options.release = detectedRelease;\n    } else {\n      // If release is not provided, then we should disable autoSessionTracking\n      options.autoSessionTracking = false;\n    }\n  }\n\n  options.environment =\n    options.environment || process.env.SENTRY_ENVIRONMENT || getVercelEnv(false) || process.env.NODE_ENV;\n\n  if (options.autoSessionTracking === undefined && options.dsn !== undefined) {\n    options.autoSessionTracking = true;\n  }\n\n  if (options.instrumenter === undefined) {\n    options.instrumenter = 'sentry';\n  }\n\n  const clientOptions: VercelEdgeClientOptions = {\n    ...options,\n    stackParser: stackParserFromStackParserOptions(options.stackParser || nodeStackParser),\n    integrations: getIntegrationsToSetup(options),\n    transport: options.transport || makeEdgeTransport,\n  };\n\n  initAndBind(VercelEdgeClient, clientOptions);\n}\n\n/**\n * Returns a release dynamically from environment variables.\n */\nexport function getSentryRelease(fallback?: string): string | undefined {\n  // Always read first as Sentry takes this as precedence\n  if (process.env.SENTRY_RELEASE) {\n    return process.env.SENTRY_RELEASE;\n  }\n\n  // This supports the variable that sentry-webpack-plugin injects\n  if (GLOBAL_OBJ.SENTRY_RELEASE && GLOBAL_OBJ.SENTRY_RELEASE.id) {\n    return GLOBAL_OBJ.SENTRY_RELEASE.id;\n  }\n\n  return (\n    // GitHub Actions - https://help.github.com/en/actions/configuring-and-managing-workflows/using-environment-variables#default-environment-variables\n    process.env.GITHUB_SHA ||\n    // Vercel - https://vercel.com/docs/v2/build-step#system-environment-variables\n    process.env.VERCEL_GIT_COMMIT_SHA ||\n    process.env.VERCEL_GITHUB_COMMIT_SHA ||\n    process.env.VERCEL_GITLAB_COMMIT_SHA ||\n    process.env.VERCEL_BITBUCKET_COMMIT_SHA ||\n    // Zeit (now known as Vercel)\n    process.env.ZEIT_GITHUB_COMMIT_SHA ||\n    process.env.ZEIT_GITLAB_COMMIT_SHA ||\n    process.env.ZEIT_BITBUCKET_COMMIT_SHA ||\n    fallback\n  );\n}\n"],"names":["createStackParser","nodeStackLineParser","inboundFiltersIntegration","functionToStringIntegration","linkedErrorsIntegration","winterCGFetchIntegration","requestDataIntegration","setAsyncLocalStorageAsyncContextStrategy","getVercelEnv","stackParserFromStackParserOptions","getIntegrationsToSetup","makeEdgeTransport","initAndBind","VercelEdgeClient","GLOBAL_OBJ"],"mappings":"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"}