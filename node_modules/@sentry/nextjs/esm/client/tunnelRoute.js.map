{"version":3,"file":"tunnelRoute.js","sources":["../../../src/client/tunnelRoute.ts"],"sourcesContent":["import type { BrowserOptions } from '@sentry/react';\nimport { dsnFromString, logger } from '@sentry/utils';\n\nimport { DEBUG_BUILD } from '../common/debug-build';\n\nconst globalWithInjectedValues = global as typeof global & {\n  __sentryRewritesTunnelPath__?: string;\n};\n\n/**\n * Applies the `tunnel` option to the Next.js SDK options based on `withSentryConfig`'s `tunnelRoute` option.\n */\nexport function applyTunnelRouteOption(options: BrowserOptions): void {\n  const tunnelRouteOption = globalWithInjectedValues.__sentryRewritesTunnelPath__;\n  if (tunnelRouteOption && options.dsn) {\n    const dsnComponents = dsnFromString(options.dsn);\n    if (!dsnComponents) {\n      return;\n    }\n    const sentrySaasDsnMatch = dsnComponents.host.match(/^o(\\d+)\\.ingest\\.sentry\\.io$/);\n    if (sentrySaasDsnMatch) {\n      const orgId = sentrySaasDsnMatch[1];\n      const tunnelPath = `${tunnelRouteOption}?o=${orgId}&p=${dsnComponents.projectId}`;\n      options.tunnel = tunnelPath;\n      DEBUG_BUILD && logger.info(`Tunneling events to \"${tunnelPath}\"`);\n    } else {\n      DEBUG_BUILD && logger.warn('Provided DSN is not a Sentry SaaS DSN. Will not tunnel events.');\n    }\n  }\n}\n"],"names":[],"mappings":";;;AAKA,MAAM,wBAAA,GAA2B,MAAO;;AAExC,CAAA;AACA;AACA;AACA;AACA;AACO,SAAS,sBAAsB,CAAC,OAAO,EAAwB;AACtE,EAAE,MAAM,iBAAA,GAAoB,wBAAwB,CAAC,4BAA4B,CAAA;AACjF,EAAE,IAAI,iBAAA,IAAqB,OAAO,CAAC,GAAG,EAAE;AACxC,IAAI,MAAM,gBAAgB,aAAa,CAAC,OAAO,CAAC,GAAG,CAAC,CAAA;AACpD,IAAI,IAAI,CAAC,aAAa,EAAE;AACxB,MAAM,OAAM;AACZ,KAAI;AACJ,IAAI,MAAM,kBAAmB,GAAE,aAAa,CAAC,IAAI,CAAC,KAAK,CAAC,8BAA8B,CAAC,CAAA;AACvF,IAAI,IAAI,kBAAkB,EAAE;AAC5B,MAAM,MAAM,KAAM,GAAE,kBAAkB,CAAC,CAAC,CAAC,CAAA;AACzC,MAAM,MAAM,UAAA,GAAa,CAAC,EAAA,iBAAA,CAAA,GAAA,EAAA,KAAA,CAAA,GAAA,EAAA,aAAA,CAAA,SAAA,CAAA,CAAA,CAAA;AACA,MAAA,OAAA,CAAA,MAAA,GAAA,UAAA,CAAA;AACA,MAAA,WAAA,IAAA,MAAA,CAAA,IAAA,CAAA,CAAA,qBAAA,EAAA,UAAA,CAAA,CAAA,CAAA,CAAA,CAAA;AACA,KAAA,MAAA;AACA,MAAA,WAAA,IAAA,MAAA,CAAA,IAAA,CAAA,gEAAA,CAAA,CAAA;AACA,KAAA;AACA,GAAA;AACA;;;;"}